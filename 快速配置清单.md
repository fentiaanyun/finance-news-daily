# ✅ 快速配置检查清单

## 📋 GitHub Secrets配置清单

[ ] **SERVERCHAN_SEND_KEY** (必需)
   - [ ] 已从 https://sctapi.ftqq.com 获取
   - [ ] 值已正确复制（长字符串，以 SCT 开头）
   - [ ] 已添加到GitHub Secrets中

[ ] **EMAIL_SENDER** (必需)
   - [ ] 已填写你的邮箱地址
   - [ ] 格式正确（xxx@qq.com 或其他）
   - [ ] 已添加到GitHub Secrets中

[ ] **EMAIL_PASSWORD** (必需)
   - [ ] 已获取授权码（16位字符）
   - [ ] ⚠️ 确认这是授权码，不是邮箱密码！
   - [ ] 已添加到GitHub Secrets中

[ ] **EMAIL_RECIPIENT** (必需)
   - [ ] 已填写接收者邮箱
   - [ ] 可与EMAIL_SENDER相同
   - [ ] 已添加到GitHub Secrets中

[ ] **SMTP_SERVER** (必需)
   - [ ] QQ邮箱填：smtp.qq.com
   - [ ] Gmail填：smtp.gmail.com
   - [ ] 163邮箱填：smtp.163.com
   - [ ] 已添加到GitHub Secrets中

[ ] **SMTP_PORT** (必需)
   - [ ] 一般填 587
   - [ ] QQ邮箱也支持 465
   - [ ] 已添加到GitHub Secrets中

[ ] **NEWS_API_KEY** (可选)
   - [ ] 从 https://newsapi.org 获取（可选）
   - [ ] 如果不需要国际新闻可跳过此项

---

## 🔐 邮箱设置检查

### QQ邮箱
[ ] POP3/IMAP/SMTP服务已开启
   - 进入：邮箱设置 → 账户 → POP3/IMAP/SMTP服务
   - 状态应显示"已开启"

[ ] 授权码已正确生成
   - 点击"生成授权码"
   - 发送短信验证
   - 复制显示的16位授权码

### Gmail (如果使用)
[ ] 已开启两步验证
[ ] 已生成应用专用密码

### 163邮箱 (如果使用)
[ ] SMTP服务已开启
[ ] 授权码已正确生成

---

## 🧪 测试步骤

### 第一步：验证SendKey有效性
```bash
# 替换 YOUR_SEND_KEY 为实际值
curl -X POST https://sctapi.ftqq.com/YOUR_SEND_KEY.send \
  -d "title=测试消息" \
  -d "desp=如果你在微信收到这条消息，说明SendKey有效"
```
- [ ] 在微信收到了测试消息

### 第二步：验证邮箱配置
在本地运行脚本（测试邮件功能）：
```powershell
# 设置环境变量
$env:EMAIL_SENDER="你的邮箱"
$env:EMAIL_PASSWORD="授权码"
$env:EMAIL_RECIPIENT="接收邮箱"
$env:SMTP_SERVER="smtp.qq.com"
$env:SMTP_PORT="587"
$env:SERVERCHAN_SEND_KEY="你的SendKey"

# 运行脚本
python fetch_news.py
```
- [ ] 收到了至少一条新闻推送
- [ ] 微信和邮箱都收到了消息

### 第三步：验证GitHub Actions工作流
- [ ] 访问仓库 → Actions 标签
- [ ] 找到 "每日财经新闻推送" 工作流
- [ ] 点击 "Run workflow" 手动运行
- [ ] 检查执行日志是否有错误
- [ ] 检查微信和邮箱是否都收到推送

---

## 🚨 故障排查

### 问题：GitHub Actions运行失败

**检查日志：**
1. 进入 Actions 标签
2. 点击最近的运行
3. 点击 "Run fetch-and-send-news script"
4. 查看红色错误信息

**常见错误信息：**

❌ **"SERVERCHAN_SEND_KEY未配置"**
- 解决：检查Secrets是否添加，名称是否完全匹配

❌ **"认证失败"或"535 Login Failure"**
- 解决：检查邮箱授权码是否正确（不是密码）

❌ **"Connection refused" 或 "超时"**
- 解决：检查网络，某些RSS源可能无法访问，脚本会自动降级

---

## 📱 验证微信推送

微信接收到的推送应该显示：
```
📊 财经早报 - 02月08日

📈 统计信息
  • 总新闻数：X 条
  • 重要新闻：Y 条
  • 更新时间：...

⭐ 【重要新闻】
...
```

如果没看到：
1. 检查Server酱SendKey是否正确
2. 检查GitHub Actions日志中是否有"推送成功"提示
3. 检查微信是否被Server酱公众号加入黑名单

---

## 📧 验证邮件推送

邮件应该显示：
```
主题：财经早报 - 2026年02月08日
内容：包含新闻列表和统计信息
```

如果没收到：
1. 检查垃圾邮件文件夹
2. 检查发件人和收件人是否设置正确
3. 对于QQ邮箱，如果用465端口失败，脚本会自动降级到587
4. 查看GitHub Actions日志了解具体错误

---

## 🔄 定时任务验证

**检查工作流是否能自动运行：**
1. 进入仓库 → Settings → Actions → General
2. 确保"Allow all actions and reusable workflows"已启用
3. 查看 `.github/workflows/daily-news.yml` 中的cron配置
4. 当前配置：每天 UTC 0点（北京时间8点）运行

**修改运行时间：**
如需改为其他时间，编辑 `.github/workflows/daily-news.yml`：
```yaml
- cron: '0 0 * * *'  # 这里改时间
```

**时区转换：**
- 北京时间 = UTC + 8小时
- 工作流用UTC时间

| 北京时间 | UTC时间 | Cron值 |
|---------|--------|-------|
| 08:00 | 00:00 | `0 0 * * *` |
| 10:00 | 02:00 | `0 2 * * *` |
| 20:00 | 12:00 | `0 12 * * *` |

---

## ✨ 一切准备好了！

完成所有检查项后：
- ✅ 工作流可以自动运行
- ✅ 新闻会每天推送到微信
- ✅ 新闻会每天推送到邮箱
- ✅ 无需手动干预

---

**需要帮助？** 查看详细配置指南：`诊断与重新配置指南.md`
